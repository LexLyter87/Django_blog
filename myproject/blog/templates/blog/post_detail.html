{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ block.super }}{% endblock %}


{% block content %}

    <article>
        <h1>{{ post.title }}</h1>
        <p>
            <small>
                Автор: {{ post.author.username }}
                Опубликовано: {{ post.created_date|date:"d.m.Y" }}
            </small>
        </p>
        <div>
            {{ post.body|linebreaks }}
        </div>
    </article>
    
    {% if user.is_authenticated and user == post.author %}
    <hr>
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'post_edit' slug=post.slug %}" class="btn btn--secondary" style="color: white; background-color: #007bff; padding: 10px; text-decoration: none; border-radius: 5px;">
            Редактировать
        </a>
        <a href="{% url 'post_delete' slug=post.slug %}"
            class="btn btn--outline"
            style="color: red; border: 1px solid red; padding: 10px; text-decoration: none; border-radius: 5px;"
            onclick="return confirm('Вы уверены, что хотите удалить этот пост?');">
            Удалить
        </a>
    </div>
    {% endif %}

    <hr>
    <h2>Комментарии ({{ comments.count }})</h2>

    {% for comment in comments %}
        <div class='comment' style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
            <p>
                <strong>{{ comment.author.username }}</strong>
                <span style="color: #777; font-size: 0.9em;">
                    - {{ comment.created_date|date:"d.m.Y H:i" }}
                </span>
            </p>
            <p>{{ comment.body|linebreaks }}</p>
        </div>
    {% empty %}
        <p>Комментариев пока нет. Будьте первым!</p>
    {% endfor %}

    <hr>

    {% if user.is_authenticated %}
        <h3>Оставить комментарий</h3>
        <form method="post">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit">Отправить</button>
        </form>
    {% else %}
        <p>ожалуйста, <a href="{% url 'login' %}?next={{request.path }}">войдите</a>, чтобы оставить комментарий.</p>
    {% endif %}

    <hr>
    <a href="{% url 'post_list' %}">← Назад ко всем постам</a>
{% endblock %}
